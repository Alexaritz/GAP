<!DOCTYPE html> 
<html>
<head>

<!-- Include meta tag to ensure proper rendering and touch zooming -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Include jQuery Mobile stylesheets -->
<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">

<!-- Include the jQuery library -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!-- Include the jQuery Mobile library -->
<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
<style>
th {
    border-bottom: 1px solid #d6d6d6;
}

tr:nth-child(even) {
    background: #e9e9e9;
}
@media all and (max-width: 44em) {
    .my-breakpoint .ui-block-a,
    .my-breakpoint .ui-block-b,
	.my-breakpoint .ui-block-c,
	.my-breakpoint .ui-block-d{
      width: 50%;
    }
  }
  @media all and (max-width: 44em) {
    .my-breakpointb .ui-block-a,
    .my-breakpointb .ui-block-b{
	  float:none;
      width: 100%;
    }
  }
</style>
</head>
<body> 

<div data-role="page" id="nireAbisuak">
	<div class="ui-grid-b" data-role="header">
		<div class="ui-block-a"><a onclick="location.href = 'nireAbisuak.html';" class="ui-btn ui-icon-arrow-l ui-btn-icon-left">Atzera</a></div>
		<div class="ui-block-b"><center><p>Lan Xehetasunak</p></center></div>
		<div class="ui-block-c"><a onclick="location.href = 'amaitu.html';" style="position: absolute;right: 0;" class="ui-btn ui-icon-power ui-btn-icon-left">Saioa itxi</a></div> 
	</div>
	<div data-role="tabs" id="tab1">
		<div id="navbar" data-role="navbar" >
				<ul>
				  <li><a href="#fragment-1" class="ui-btn-active">Abisuaren xehetasunak</a></li>
				  <li><a href="#fragment-2" id="abisuaOsatutab">Abisua Osatu</a></li>
				</ul>
		</div>
		<div id="fragment-1">
			<fieldset class="ui-grid-c my-breakpoint">
				<div class="ui-block-a">
					<div class="ui-bar ui-bar-a">ID</div>
					<div class="ui-body " id="id"></div>
				</div>
				<div class="ui-block-b">
					<div class="ui-bar ui-bar-a">Saila</div>
					<div class="ui-body" id="saila"></div>
				</div>	
				<div class="ui-block-c">
					<div class="ui-bar ui-bar-a">Lehentasuna</div>
					<div class="ui-body" id="lehentasuna"></div>
				</div>	
				<div class="ui-block-d">
					<div id="bidal" class="ui-bar ui-bar-a">Bidaltzailea</div>
					<div class="ui-body" id="bidaltzailea"></div>
				</div>	
			</fieldset>
			<fieldset class="ui-grid-a my-breakpoint">
				<div class="ui-block-a">
					<div class="ui-bar ui-bar-a">Tokia</div>
					<div class="ui-body" id="tokia"></div>
				</div>
				<div class="ui-block-b">
					<div class="ui-bar ui-bar-a">Data</div>
					<div class="ui-body" id="data"></div>
				</div>
			</fieldset>
			<fieldset class="ui-grid-a my-breakpointb">
				<div class="ui-block-a">
					<div class="ui-bar ui-bar-a" >Laburpena</div>
					<div class="ui-body" id="laburpena"></div>
				</div>
				<div class="ui-block-b">
					<div class="ui-bar ui-bar-a" >Deskribapena</div>
					<div class="ui-body" id="deskribapena"></div>
				</div>
			</fieldset>
					<div class="ui-bar ui-bar-a">Argazkia</div>
					<div class="ui-body"><img id="image" alt="Ez dauka argazkirik." width="100%"></img></div>
		</div>
		<div id="fragment-2">
			<form id="abisuaOsatu">
				<fieldset class="ui-grid-a my-breakpointb">
					<div id="egdiv" class="ui-block-a">
						<select id="egoera" name="egoera" required>
								<option value="">Egoera</option>
								
						</select>
					</div>
					<div class="ui-block-b">
					<fieldset class="ui-grid-a my-breakpointb">
					<div class="ui-block-a">
						<label for="slider-h">Denbora (h):</label>
						<input type="range" name="slider-h" id="slider-h" min="0" max="50" value="25" data-popup-enabled="true">
						</div>
						<div class="ui-block-b">
						<label for="slider-min">Denbora (min):</label>
						<input type="range" name="slider-min" id="slider-min" min="0" max="59" value="30" data-popup-enabled="true">
						</div>
					</div>	      
				</fieldset>
				<fieldset class="ui-grid-a my-breakpointb">
					<textarea  id="azalpena"  placeholder="Azalpena..." required></textarea>
				</fieldset>
			<input type="submit" value="Gorde" name="submit" id="submit" data-theme="b">
			</form>
		</div>
	</div>
</div>
<script>
$(document).ready(function(){
$.mobile.loading('show');
user = window.localStorage.getItem('username');
id = window.localStorage.getItem('lanID');
		/*Lanaren xehetasunak*/
		lanfitx = "PHP/lanXehetasunak.php?jsoncallback=?"
		$.getJSON( lanfitx, { usuario:user, lanid:id})
		.done(function(lanerantzuna) {
			$(lanerantzuna).each(function (index, l) {
				ard=l.arduraduna
				$('#id').text(l.id);
				$('#saila').text(l.saila);
				$('#lehentasuna').text(l.lehentasuna);
				if(ard!=user) $('#bidaltzailea').text(l.arduraduna);
				else $('#bidaltzailea').text(l.username);
				$('#tokia').text(l.eraikina+l.pisua+"."+l.gela);
				$('#data').text(l.data);
				$('#laburpena').text(l.laburpena);
				$('#deskribapena').text(l.deskribapena);
				if(l.argazkia!=""){
					$('#image').attr('src', "ARGAZKIAK/"+l.argazkia);
				}
			});
			if(ard!=user){
				$("#abisuaOsatutab").hide();
				$("#bidal").text("Arduraduna");
			}else{
				//lanaren xehetasunak lortu
				lanxehetasunFitx = "PHP/lanHasiak.php?jsoncallback=?"
					$.getJSON( lanxehetasunFitx, { usuario:user, lanid:id})
					.done(function(lanxeheterantzuna) {
						$(lanxeheterantzuna).each(function (index, o) {
							$( "#slider-h" ).val(o.denborah);
							$( "#slider-h" ).slider("option","value",o.denborah);
							$( "#slider-min" ).val(o.denboramin)
							$("#azalpena").val(o.azalpena);
						});
					})
					.fail(function(lanxeheterantzuna,textStatus, error) {
						var err = textStatus + ', ' + error;
						alert("Request Failed: " + err);
					});
					/*Lanaren egoera*/
				egoerafitx = "PHP/egoeraLortu.php?jsoncallback=?"
				$.getJSON( egoerafitx, { usuario:user, lanid:id})
				.done(function(egoeraerantzuna) {
					console.log("KODEA ONDO")
					$(egoeraerantzuna).each(function (index, o) {
						if(o.izena==null || o.izena=='undefined'){//DATU BASEKIN NOLABAIT LOTU...?
							var id="#"+o;
							$(id).attr("selected","selected");
							var selector=$('#egoera');
							$("select").selectmenu("refresh");
						}
						else{
							var $option = $("<option id='"+o.izena+"'/>").attr("value", o.izena).text(o.izena);
							$('#egoera').append($option);
						}
					});
				})
				.fail(function(egoeraerantzuna,textStatus, error) {
					var err = textStatus + ', ' + error;
					console.log("Request Failed: " + err);
				})
		}
		})
		.fail(function(koderantzuna,textStatus, error) {
			var err = textStatus + ', ' + error;
            console.log("Request Failed: " + err);
		})	
$.mobile.loading('hide');
});


$("form").submit(function(){
var egoera=$("#egoera").val()
if (confirm("Ziur lana itxi nahi duzula?")==true && egoera=="itxia"){
$.mobile.loading('show');
var user = window.localStorage.getItem('username');
var lanid = window.localStorage.getItem('lanID');
var denborah=$("#slider-h").val()
var denboramin=$("#slider-min").val()
var azalpena=$("#azalpena").val()
var egoera=$("#egoera").val()
xehetasunFitx = "PHP/lanaOsatu.php?jsoncallback=?"
			$.getJSON( xehetasunFitx, { usuario:user, lanid:lanid, denborah:denborah, denboramin:denboramin, azalpena:azalpena})
			.done(function(xeheterantzuna) {
				console.log(xeheterantzuna.mezua)
			})
			.fail(function(xeheterantzuna,textStatus, error) {
				var err = textStatus + ', ' + error;
				alert("Request Failed: " + err);
			});
		egoeraFitx = "PHP/egoeraEguneratu.php?jsoncallback=?"
			$.getJSON( egoeraFitx, { usuario:user, lanid:lanid, egoera:egoera})
			.done(function(egoerantzuna) {
				$.mobile.loading('hide');
				location.reload();
			})
			.fail(function(egoerantzuna,textStatus, error) {
				var err = textStatus + ', ' + error;
				console.log("Request Failed: " + err);
			});
	return false;
}else{
return false;
}
});

</script>

</body>
</html>