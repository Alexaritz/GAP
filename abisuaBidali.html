<!DOCTYPE html> 
<html>
<head>

<!-- Include meta tag to ensure proper rendering and touch zooming -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Include jQuery Mobile stylesheets -->
<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">

<!-- Include the jQuery library -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!-- Include the jQuery Mobile library -->
<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
<style>

@media all and (max-width: 22em) {
    .my-breakpoint .ui-block-a,
    .my-breakpoint .ui-block-b{
      width: 100%;
      float:none;
    }
  }
  @media all and (max-width: 30em) {
    .my-breakpointb .ui-block-a,
    .my-breakpointb .ui-block-b{
      width: 100%;
      float:none;
    }
  }
#custom-fieldset .ui-controlgroup-controls {
    width: 99.5%;
}

#custom-fieldset .ui-controlgroup-controls .ui-select {
    width: 33.33%;
}
img {
    height: auto; /* Make sure images with WordPress-added height and width attributes are scaled correctly */
    max-width: 100%; /* Prevent images from overflowing their boundaries */
}
</style>
</head>

<body> 
<div data-role="page" id="abisuaBidali">

	<div class="ui-grid-b" data-role="header">
		<div class="ui-block-a"><a onclick="location.href = 'menua.html';" style="position: absolute;left: 0;" class="ui-btn ui-icon-arrow-l ui-btn-icon-left">Atzera</a></div>
		<div class="ui-block-b"><center><p>Abisua bidali</p></center></div>
		<div class="ui-block-c"><a onclick="location.href = 'amaitu.html';" style="position: absolute;right: 0;" class="ui-btn ui-icon-power ui-btn-icon-left">Saioa itxi</a></div> 
	</div>
	<div data-role="content" class="app">	
		<form id="abisuForm" method="post" enctype="multipart/form-data">
			<fieldset class="ui-grid-a my-breakpoint">
				<div class="ui-block-a">
					<select id="arazoM" name="arazoM" required>
							<option value="">Arazo mota</option>
					</select>
				</div>
				<div class="ui-block-b">
					<select id="arduraduna" name="arduraduna" required>
							<option value="">Arduraduna</option>
					</select>
				</div>	      
			</fieldset>
			<fieldset class="ui-grid-a my-breakpointb">
			<div class="ui-block-a">
			<fieldset data-role="controlgroup" data-type="horizontal" id="custom-fieldset">
				<select id="eraikina" name="eraikina" class="myselector" required>
						<option value="">Eraikina</option>
						<option value="A">A</option>
				</select>
				<select id="pisua" name="pisua" class="myselector" required>
						<option value="">Pisua</option>
						<option value="1">1</option>
				</select>
				<select id="gela" name="gela" class="myselector" required>
						<option value="">Gela</option>
						<option value="1">1</option>
				</select>
			</fieldset>
			</div>
			<div class="ui-block-b" >
				<select id="lehentasuna" name="lehentasuna" required>
						<option value="">Lehentasuna</option>
						<option value="Baxua">Baxua</option>
						<option value="Normala">Normala</option>
						<option value="Premiazkoa">Premiazkoa</option>
				</select>
			</div>	
			</fieldset>
      		<input type="text" id="laburpena" name="laburpena" placeholder="Laburpena" required>
			<textarea name="deskribapena" id="deskribapena"  placeholder="Deskribapena..." required></textarea>
			<input type="file"  accept="image/*" name="fileToUpload" id="fileToUpload">
			<img style="display:none" align="middle" id="blah" width="50%" src="#">
			<!--<canvas  id="myCanvas" style="display:none" width="240" height="297" >
				Your browser does not support the HTML5 canvas tag.</canvas>-->
			<input type="submit" value="Bidali" name="submit" id="submit" data-theme="b">
    	</form>			   
	</div>
	 
</div>
<script>
$(document).ready(function(){
var user = window.localStorage.getItem('username');
		/*ARAZO MOTA BETE*/
		kodefitx = "PHP/arazoMota.php?jsoncallback=?"
		$.getJSON( kodefitx, { usuario:user})
		.done(function(koderantzuna) {
			console.log("ONDO")
			$(koderantzuna).each(function (index, o) {
				var $option = $("<option/>").attr("value", o.kodea).text(o.izena);
				$('#arazoM').append($option);
			});
		})
		.fail(function(koderantzuna,textStatus, error) {
			var err = textStatus + ', ' + error;
            console.log("Request Failed: " + err);
		})
		/*return false*/;
		
		/*ARDURADUNA BETE*/
		ardfitx = "PHP/arduradunaLortu.php?jsoncallback=?"
		$.getJSON( ardfitx, { usuario:user})
		.done(function(arderantzuna) {
			console.log("ONDO2")
			$(arderantzuna).each(function (index, o) {
				var $option = $("<option/>").attr("value", o.username).text(o.username);
				$('#arduraduna').append($option);
			});
		})
		.fail(function(arderantzuna,textStatus, error) {
			var err = textStatus + ', ' + error;
            console.log("Request Failed: " + err);
		})
		return false;		
});

function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
			 $('#blah').attr('style', "");
            $('#blah').attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
}
$("#fileToUpload").change(function() {
        var argazkia=$("#fileToUpload").val()
		readURL(this);
	
	/*
	var canvas = document.getElementById("myCanvas");
	var img = document.getElementById("fileToUpload");
	img.src = window.URL.createObjectURL(argazkia);
	
	var ctx = canvas.getContext("2d");
	ctx.drawImage(img, 0, 0);
	
	var MAX_WIDTH = 800;
	var MAX_HEIGHT = 600;
	var width = img.width;
	var height = img.height;
	 
	if (width > height) {
	  if (width > MAX_WIDTH) {
		height *= MAX_WIDTH / width;
		width = MAX_WIDTH;
	  }
	} else {
	  if (height > MAX_HEIGHT) {
		width *= MAX_HEIGHT / height;
		height = MAX_HEIGHT;
	  }
	}
	canvas.width = width;
	canvas.height = height;
	var ctx = canvas.getContext("2d");
	ctx.drawImage(img, 0, 0, width, height);
	 var c = document.getElementById("myCanvas");
    var ctx = c.getContext("2d");
    var img = document.getElementById("fileToUpload");
    ctx.drawImage(img, 10, 10);*/
    });
$("form").submit(function(){
	var user = window.localStorage.getItem('username');
	var saila=$("#arazoM").val()
	var arduraduna=$("#arduraduna").val()
	var eraikina=$("#eraikina").val()
	var pisua=$("#pisua").val()
	var gela=$("#gela").val()
	var lehentasuna=$("#lehentasuna").val()
	var laburpena=$("#laburpena").val()
	var deskribapena=$("#deskribapena").val()
	var argazkia = $("#fileToUpload").val().replace(/C:\\fakepath\\/i, '')
	
	
	
	abisuFitx = "PHP/abisuaBidali.php?jsoncallback=?"
		$.getJSON( abisuFitx, { usuario:user, saila:saila, arduraduna:arduraduna, eraikina:eraikina, pisua:pisua, gela:gela, lehentasuna:lehentasuna,laburpena:laburpena,deskribapena:deskribapena,argazkia:argazkia})
		.done(function(abisuerantzuna) {
			console.log("ZUZEN TXERTATU DA")
		})
		.fail(function(abisuerantzuna,textStatus, error) {
			var err = textStatus + ', ' + error;
            console.log("Request Failed: " + err);
		})
		/*return false;*/
		$.ajax({
			url: "upload.php", // Url to which the request is send
			type: "POST",             // Type of request to be send, called as method
			data: new FormData(this), // Data sent to server, a set of key/value pairs (i.e. form fields and values)
			contentType: false,       // The content type used when sending data to the server.
			cache: false,             // To unable request pages to be cached
			processData:false,        // To send DOMDocument or non processed data file it is set to false
			success: function(data)   // A function to be called if request succeeds
			{alert("Abisua zuzen bidali da")
			window.location.replace("menua.html");
			}
		});
		
    
});
</script>
</body>
</html>